<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="prism.js"></script>
    <link href="prism.css" rel="stylesheet" />
    <style>
        body {
            background-color: #000000;
            background-image: linear-gradient(147deg, #000000 0%, #434343 74%);
            background-attachment: fixed;
            text-align: center;
        }

        audio {
            display: none;
        }

        canvas {
            border: 1px solid #d3d3d3;
            background-color: #f1f1f1;
            float: left;
        }

        h1 {
            border-bottom: solid 1px white;
        }

        #right-box {
            color: white;
            margin: 20px;
            margin-left: 1020px;
            height: 760px;
            text-align: left;
            padding: 20px;
            background-color: #000000;
            background-image: linear-gradient(147deg, #000000 0%, #434343 74%);
            border: 1px solid #d3d3d3;
            overflow-y: auto;
        }

        .button {
            width: 100%;
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            display: inline-block;
        }

        .button:hover {
            color: black;
        }

        #bot-button {
            display: none;
        }

        @media only screen and (max-width: 1227px) {
            canvas {
                float: none;
            }

            #right-box {
                margin-left: 20px;
            }

            #top-button {
                display: none;
            }

            #bot-button {
                display: none;
            }

        }

        img {
            width: 180px;
        }
    </style>

    <audio id="car-sound-fx">
        <source src="./sound/car_sound_fx.mp3" type="audio/mp3">
    </audio>

    <audio id="airplane-sound-fx">
        <source src="./sound/airplane.mp3" type="audio/mp3">
    </audio>
</head>

<body onload="startCanvas()">

    <div id="right-box">
        <div class="box-header">
            <button id="top-button" class="button" onclick="addCss()">Visualizar documentação abaixo</button>
            <button id="bot-button" class="button" onclick="addCss()">Visualizar documentação na aba lateral</button>
        </div>
        <h2>Função responsável pelo 'looping' da animação</h2>
        <pre><code class="language-js">
function loopCars() {
    for (var i = 0; i < 50; i++) {
        delay = i * delayMilliseconds;
        doTimeoutCar1(i, delay); // faz o looping do carro 1
        doTimeoutCar2(i, delay); // " do carro 2
        doTimeoutCar3(i, delay); // " do carro 3
        doTimeoutAirplane(i, delay); // " do avião
    }
}
        </code></pre>
        <h1>Carro 1 (preto)</h1>
        <img src="img/car1.png" style="float: left; margin-top: 40px;" alt="">
        <h4>Posição:</h4>
        <pre><code class="language-js">
car1 = new component(115, 75, "img/car1.png", -115, 160, "image", 0);
        </code></pre>
        <h4>Movimento:</h4>
        <pre><code class="language-js"> 
function doTimeoutCar1(i, delay) {
    setTimeout(function () {
        if ((i > 0) && (i < 25)) {
            if (i == 2) {
                carsSound = document.getElementById("car-sound-fx");
                carsSound.volume = 0.4;
                carsSound.currentTime = 0;
                carsSound.play();
            }
            sem2 = new component(115, 115, "img/semGreen.png", 350, 70, "image", 0);
            sem1 = new component(115, 115, "img/semRed.png", 100, 70, "image", 0);
            if (i > 7)
                clearmove(car1);
            if (i >= 24) {
                sem1 = new component(115, 115, "img/semGreen.png", 100, 70, "image", 0);
            }
        }
        else if (i == 49) {
            resetcar1();
            loopCars();
        } else {
            if (i > 38)
                sem1 = new component(115, 115, "img/semYellow.png", 100, 70, "image", 0);
            move("right", car1);
        }
    }, delay);
}
        </code></pre>

        <h1>Carro 2 (prata)</h1>
        <img src="img/car2.png" style="width: 100px; float: left;" alt="">
        <h4>Posição:</h4>
        <pre><code class="language-js">
car2 = new component(75, 115, "img/car2.png", 212, -250, "image", 0);
        </code></pre>
        <br style="clear: both;">
        <h4>Movimento:</h4>
        <pre><code class="language-js">
function doTimeoutCar2(i, delay) {
    setTimeout(function () {
        if (i > 18 && i < 25) {
            sem2 = new component(115, 115, "img/semYellow.png", 350, 70, "image", 0);
            if (i >= 24)
                sem2 = new component(115, 115, "img/semRed.png", 350, 70, "image", 0);
        } else if (i == 49) {
            resetcar2();
        } else {
            move("down", car2);
        }
    }, delay);
}
    </code></pre>

        <h1>Carro 3 (vermelho)</h1>
        <img src="img/car3.png" style="float: left; width: 100px;" alt="">
        <h4>Posição:</h4>
        <pre><code class="language-js">
car3 = new component(75, 115, "img/car3.png", 250, -115, "image", 0);
        </code></pre>
        <br style="clear: both;">
        <h4>Movimento:</h4>
        <pre><code class="language-js">
function doTimeoutCar3(i, delay) {
    setTimeout(function () {
        if (i <= 9)
            move("down", car3);
        else if (i == 10) {
            move("rotate", car3);

        } else if (i == 49) {
            resetcar3();
        } else
            move("right", car3);
    }, delay);
}
        </code></pre>

        <h1>Avião</h1>
        <img src="img/airplane.png" style="float: left; width: 180px; margin-top: 30px;" alt="">
        <h4>Posição:</h4>
        <pre><code class="language-js">
airplane = new component(350, 350, "img/airplane.png", -150, -150, "image", 0);
        </code></pre>
        <br style="clear: both;">
        <h4>Movimento:</h4>
        <pre><code class="language-js">
function doTimeoutAirplane(i, delay) {
    setTimeout(function () {
        if (i == 19) {
            airplaneAudio = document.getElementById("airplane-sound-fx");
            airplaneAudio.volume = 0.3;
            airplaneAudio.currentTime = 0.1;
            airplaneAudio.play();
        }
        if (i > 25) {
            move("right", airplane);
            move("down", airplane);
        }
        if (i == 49)
            resetAirplane();
    }, delay);
}
        </code></pre>
    </div>
    <script>

        var car1;
        var car2;
        var car3;
        var airplane;
        var myBackground;
        var sem1;
        var sem2;

        var view = true;

        function startCanvas() {
            airplane = new component(350, 350, "img/airplane.png", -150, -150, "image", 0);
            car1 = new component(115, 75, "img/car1.png", -115, 160, "image", 0);
            car2 = new component(75, 115, "img/car2.png", 212, -250, "image", 0);
            car3 = new component(75, 115, "img/car3.png", 250, -115, "image", 0);
            sem1 = new component(115, 115, "img/semYellow.png", 100, 70, "image", 0);
            sem2 = new component(115, 115, "img/semGreen.png", 350, 70, "image", 0);
            myBackground = new component(1000, 800, "img/background.png", 0, 0, "image", 0);
            myGameArea.start();
            move("right", car1);
        }

        function addCss() {
            if (view) {
                myGameArea.canvas.style.float = "none";
                document.getElementById("right-box").style.marginLeft = "20px";
                document.getElementById("top-button").style.display = "none";
                document.getElementById("bot-button").style.display = "block";
            }
            else {
                myGameArea.canvas.style.float = "left";
                document.getElementById("right-box").style.marginLeft = "1020px";
                document.getElementById("top-button").style.display = "block";
                document.getElementById("bot-button").style.display = "none";
            }
            view = !view;
        }


        var myGameArea = {
            canvas: document.createElement("canvas"),
            start: function () {
                this.canvas.width = 1000;
                this.canvas.height = 800;
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                this.frameNo = 0;
                this.interval = setInterval(updateGameArea, 20);
            },
            clear: function () {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            },
            stop: function () {
                clearInterval(this.interval);
            }
        }

        function component(width, height, image, x, y, type, angle) {
            this.type = type;
            this.image = new Image();
            this.image.src = image;
            this.width = width;
            this.height = height;
            this.speedX = 0;
            this.speedY = 0;
            this.x = x;
            this.y = y;
            this.angle = 0;

            this.update = function () {
                ctx = myGameArea.context;
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                ctx.drawImage(this.image,
                    this.x,
                    this.y,
                    this.width, this.height,
                );
                ctx.restore();
            }
            this.newPos = function () {
                this.x += this.speedX;
                this.y += this.speedY;
            }
        }

        function updateGameArea() {
            myGameArea.clear();
            myBackground.newPos();
            myBackground.update();
            car1.newPos();
            car1.update();
            car2.newPos();
            car2.update();
            car3.newPos();
            car3.update();
            sem1.newPos();
            sem1.update();
            sem2.newPos();
            sem2.update();
            airplane.newPos();
            airplane.update();
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function move(dir, car) {

            if (dir == "down") { car.speedY = 2; }
            if (dir == "right") { car.speedX = 2; }
            if (dir == "rotate") {
                for (var i = 0; i < 90; i++) {
                    car.angle -= 1 * Math.PI / 180;
                    await sleep(0.1);
                    car.y += 2.4 + (0.035 * i);
                    car.x -= 0.95 + (0.03 * i);
                }
            }
        }

        function clearmove(car) {
            car.speedX = 0;
            car.speedY = 0;
        }

        function resetcar1() {
            sem1 = new component(115, 115, "img/semYellow.png", 100, 70, "image", 0);
            car1 = new component(115, 75, "img/car1.png", -115, 160, "image", 0);
        }

        function resetAirplane() {
            airplane = new component(350, 350, "img/airplane.png", -150, -150, "image", 0);
        }

        function resetcar2() {
            car2 = new component(75, 115, "img/car2.png", 212, -250, "image", 0);
        }

        function resetcar3() {
            car3 = new component(75, 115, "img/car3.png", 250, -115, "image", 0);
        }

        var delay = 0;
        var delayMilliseconds = 250;

        function doTimeoutCar1(i, delay) {
            setTimeout(function () {
                if ((i > 0) && (i < 25)) {
                    if (i == 2) {
                        carsSound = document.getElementById("car-sound-fx");
                        carsSound.volume = 0.4;
                        carsSound.currentTime = 0;
                        carsSound.play();
                    }
                    sem2 = new component(115, 115, "img/semGreen.png", 350, 70, "image", 0);
                    sem1 = new component(115, 115, "img/semRed.png", 100, 70, "image", 0);
                    if (i > 7)
                        clearmove(car1);
                    if (i >= 24) {
                        sem1 = new component(115, 115, "img/semGreen.png", 100, 70, "image", 0);
                    }
                }
                else if (i == 49) {
                    resetcar1();
                    loopCars();
                } else {
                    if (i > 38)
                        sem1 = new component(115, 115, "img/semYellow.png", 100, 70, "image", 0);
                    move("right", car1);
                }
            }, delay);
        }

        function doTimeoutCar2(i, delay) {
            setTimeout(function () {
                if (i > 18 && i < 25) {
                    sem2 = new component(115, 115, "img/semYellow.png", 350, 70, "image", 0);
                    if (i >= 24)
                        sem2 = new component(115, 115, "img/semRed.png", 350, 70, "image", 0);
                } else if (i == 49) {
                    resetcar2();
                } else {
                    move("down", car2);
                }
            }, delay);
        }

        function doTimeoutCar3(i, delay) {
            setTimeout(function () {
                if (i <= 9)
                    move("down", car3);
                else if (i == 10) {
                    move("rotate", car3);

                } else if (i == 49) {
                    resetcar3();
                } else
                    move("right", car3);
            }, delay);
        }

        function doTimeoutAirplane(i, delay) {
            setTimeout(function () {
                if (i == 19) {
                    airplaneAudio = document.getElementById("airplane-sound-fx");
                    airplaneAudio.volume = 0.3;
                    airplaneAudio.currentTime = 0.1;
                    airplaneAudio.play();
                }
                if (i > 25) {
                    move("right", airplane);
                    move("down", airplane);
                }
                if (i == 49)
                    resetAirplane();
            }, delay);
        }

        function loopCars() {
            for (var i = 0; i < 50; i++) {
                delay = i * delayMilliseconds;
                doTimeoutCar1(i, delay);
                doTimeoutCar2(i, delay);
                doTimeoutCar3(i, delay);
                doTimeoutAirplane(i, delay);
            }
        }
        loopCars();
    </script>
</body>

</html>